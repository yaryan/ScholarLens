--- Page 1 --- Learning constitutive models and rheology from partial flow measurements Alp M. Sunol∗ and James V. Roggeveen∗ John A. Paulson School of Engineering and Applied Sciences, Harvard University, Cambridge, MA 02138, USA Mohammed G. Alhashim Research and Development Center, Saudi Aramco, Dhahran 31311, Saudi Arabia Henry S. Bae and Michael P. Brenner† John A. Paulson School of Engineering and Applied Sciences, Harvard University, Cambridge, MA 02138, USA and Department of Physics, Harvard University, Cambridge, MA 02138, USA (Dated: October 29, 2025) Constitutive laws are at the core of fluid mechanics, relating the fluid stress to its deformation rate. Unlike Newtonian fluids, most industrial and biological fluids are non-Newtonian, exhibiting a nonlinear relation. Accurately characterizing this nonlinearity is essential for predicting flow behaviorinreal-worldengineeringandtranslationalapplications. Yetcurrentmethodsfallshortby relying on bulk rheometer data and simple fits that fail to capture behaviors relevant in complex geometries and flow conditions. Data-driven approaches can capture more complex behaviors, but lackinterpretabilityorconsistency. Toclosethisgap,weleverageautomaticdifferentiationtobuild anend-to-endframeworkforrobustrheologicallearning. Wedevelopadifferentiablenon-Newtonian fluid solver with a tensor basis neural network closure that learns stress directly from arbitrary flow measurements, such as velocimetry data. In parallel, we implement differentiable versions of majorconstitutiverelations,enablingBayesianmodelparametrizationandselectionfromrheometer data. Our framework predicts flows in unseen geometries and ensures physical consistency and interpretability by matching neural network responses to known constitutive laws. Ultimately, this worklaysthegroundworkforadvanceddigitalrheometrycapableofcomprehensivelycharacterizing non-Newtonian and viscoelastic fluids under realistic in-situ or in-line operating conditions. Keywords: rheology; automatic differentiation; inverse problems; fluid mechanics; model selection Author Contributions: A.M.S., J.V.R., and M.P.B. designed research; A.M.S. developed the differentiable non- Newtonian fluid solver and performed the tensor basis neural network training and analysis; J.V.R. developed the differentiable model-fitting framework and performed the bulk rheometry analysis; M.G.A. and H.S.B. assisted with initial implementations and numerical validation; and A.M.S., J.V.R., and M.P.B. wrote the paper. Modeling and understanding how fluids behave in dif- ple, specific parameters in a simple constitutive law can ferent conditions and geometries requires an accurate aid in understanding the microstructural evolution of a mathematical description of the relationship between lo- fluid, such as the transition to jammed packing [15, 16]. cal stress and local deformation. Such constitutive laws Other constitutive laws are more phenomenological, de- serve as a pillar of fluid mechanics, material science, and rived mathematically to capture particular observed be- engineering, with applications from drug delivery to oil haviors in distinct classes of complex fluids. Ultimately, extraction [1, 2]. In its most basic form, a constitutive describing a fluid in terms of any constitutive model re- law gives a one-dimensional functional relationship be- quires inferring a set of material parameters from exper- tween a scalar stress and a scalar strain rate [3–6]. In imental data to enable predictive modeling in new con- manyinstances,suchsimpledescriptionscanbeextended ditions and geometries. tothreedimensionstoproviderelationshipsbetweenten- sorial quantities. More complex constitutive laws can However,suchpredictionscanoftenfail,highlightinga involve additional evolution equations for stress tensors fundamentaldisconnectbetweenhowconstitutivemodels [7–9]. In such cases, the constitutive equations must be are parameterized and how they are applied. For exam- solved concurrently with the Navier–Stokes equations to ple,materialparametersforaBogerfluidfitfromsimple obtain predictive models of fluid behavior [10–12]. shear rheometry often fail to predict the fluid’s strong Differentobjectivesmotivateassigningandfittingcon- extensional response in contractional geometries, some- stitutive models to fluid data [3, 13, 14]. For exam- times predicting the opposite sign for the pressure drop [17–20]. Thecauseofsuchfailuresaretwofold. First,the choice of a constitutive law is itself an assumption. Pa- rametersfitinoneflowregime,suchassimpleshear,may ∗ Theseauthorscontributedequally. maskthemodel’sinabilitytorepresentthephysicsofan- †  other, like mixed shear and extension [21, 22]. Second, 5202 tcO 82 ]nyd-ulf.scisyhp[ 1v37642.0152:viXra --- Page 2 --- 2 Tensor Basis Neural Network tr(D2) tr(W2) Optimizedw∗ Update TBNNweightsw JAXGradient TBNN ∇w FlowSolver Loss α1 α2 Data Flow Data σ=α1D+α2(WD −DW) Predicted Flow TBNN Training TBNN Architecture Differentiable Model Fitting Model=Giesekus Optimizedθ∗ η =0.2 Pa s s · Update η =1.0 Pa s Parametersθ JAXGradient p · ∇θ λ=4.0 s ODESolver Loss α=0.5 Data BIC= 800 − Experimental Data Differentiable Solver FIG. 1. Learning rheological models from flow data. Top: A tensor basis neural network (TBNN) that maps scalar invariants of the kinematics to the stress is embedded in a differentiable flow solver. Training on any type of flow data with JAX gradients yields a TBNN that generalizes across conditions and geometries and enables flow prediction. Bottom: For interpretability and extrapolation, we also implement a differentiable ODE framework that fits the learned TBNN model’s to classicalconstitutivelaws(e.g. Giesekus)andselectsthebestmodelandparametersusingtheBayesianInformationCriterion (BIC). standard rheological measurements, such as frequency [32,33]. Thesedata-drivenmethodshaveshownpromise sweeps and small-amplitude oscillatory tests, may lack in fitting small data sets to produce accurate stress pre- sufficient kinematic detail required to constrain param- dictionsundercertainconditions. However,themachine- eters or to distinguish between competing constitutive learningmodelsmaystillstruggletogeneralizewhenonly models [13, 23–25]. Consequently, a model may appear limitedbulkrheometrydataareavailablefortraining,es- well-fittorheometerdatayetfailinpredictingresponses pecially given the large number of parameters that must in other systems, not because its parameters are wrong, be inferred from sparse, bulk measurements. but because the underlying model form or the data used tofititwerenotrepresentativeofthetargetapplication. Other data-driven approaches have attempted to find relevant constitutive laws from velocity measurements. These challenges have motivated a growing body of One such approach that has been popular is to use work that moves away from classical constitutive models Physics-InformedNeuralNetworks[34]tomodeltheflow toward data-driven approaches for representing complex behavior[35–38],butPINN-basedmethodslearnfromve- fluidbehavior. Oneclassofthesemethodshasfocusedon locity fields with soft physics constraints and domain- modeling bulk rheometer data using machine-learning, specific boundary conditions, which makes them a pow- including Rheological Universal Differential Equations erful tool for model discovery but not portable across (RUDEs) [26] and Rheology Informed Neural Networks geometries. Other approaches attempt to infer con- (RhINNs) [27–31]. In these works, the authors replace stitutive laws from velocity measurements by solving componentsofclassicalconstitutivelawswithneuralnet- adjoint-accelerated inverse problems for specific consti- workstrainedonexperimentaldata,whicharethenused tutive models, such as the Carreau model [39]. While topredictstressesinunseenflowconditions. Othertech- powerful, these methods require formulating and solv- niques, based on sparse symbolic regression, aim to dis- ing an adjoint problem for each geometry and consti- coversimple,interpretablemodelsdirectlyfromthedata tutive model considered, which can be technically de- --- Page 3 --- 3 manding and computationally expensive. In addition, rectly from data. As detailed in Methods Sec. B, the evaluating multiple candidate models in this framework TBNN encodes Galilean invariance by construction and, would necessitate repeating the inversion procedure for whensuppliedwiththefullinvariantsetandtensorbases, each model separately, making broad model selection in can represent any physically admissible stress. Thus, it complex geometries impractical. servesasageometry-agnosticconstitutiverepresentation In this paper, we present a novel approach that lever- that can be embedded in any simulation to reproduce ages automatic differentiation and differentiable sim- the measured flow behavior. Conceptually, this process ulations to efficiently learn constitutive relationships isillustratedinthetoppanelofFig.1, wheretheTBNN from arbitrary flow measurements and then relate these learns from flow data to yield a transferable constitutive relationships back to classical constitutive laws (Fig. model. 1). Specifically, we develop a fully differentiable non- To demonstrate this framework, we first consider a Newtonianfluidsolver, buildinguponrecentadvancesin canonicalshear-thinningCarreau–Yasuda(CY)model,a differentiable CFD [40, 41], by embedding a tensor ba- standard benchmark in non-Newtonian rheology, widely sis neural network (TBNN) [42] directly into the solver used to represent the smooth shear-thinning behavior to learn the stress-strain relationship from experimental characteristic of polymer solutions and biological fluids flow data. This approach allows us to capture the com- [4, 5, 43, 44]. We use a fluid with parameters η = 1.0, 0 plex relationship between stress and strain in the flow η =0.02, k =5.0, n=0.7, and a=2.0 as a baseline for ∞ without needing to perform an expensive differentiable validating the framework before relaxing these parame- simulation for every possible constitutive model. tersandextendingtootherconstitutivefamilies. Rather Wetheninterrogatethelearnedconstitutivemodelen- than relying on simple shear, training is performed on capsulatedintheTBNNtoextractinterpretablephysics. an information-rich pressure-driven flow that spans or- By fitting its stress response to established constitutive ders of magnitude in local strain rate and thus a wide laws, we efficiently identify the classical model and pa- range of viscosities (Fig. S1). Specifically, we simulate rameters that best describe the learned behavior. This flowthroughaconstriction–expansionchannelcontaining two-stage process transforms any flow measurement—no asemi-circularobstacleunderanondimensionalpressure matter how complex the geometry—into a potential gradient of G = 5 (see Methods Sec. B for unit defini- rheometer,enablingexplorationofconstitutiveresponses tions). The resulting steady-state velocity field, shown inaccessible in traditional experiments. inFig.2a,exhibitsstrongspatialvariationsinshearrate that provide an ideal dataset for learning a generalized constitutive relation. LEARNING RHEOLOGICAL MODELS FROM We train the TBNN on this dataset to learn the un- VELOCIMETRY derlyingstresslawdirectlyfromtheflow,wheretheneu- ral network is formulated to predict a viscosity field as a Learning constitutive behavior directly from complex functionoflocalinvariants(MethodsSec. C).Themodel flow fields requires a formulation that exposes how istrainedusingthedifferentiableflowsolverdescribedin changes in material parameters propagate throughout MethodsSec. B,withgradientsevaluatedonlyatsteady the entire fluid domain. To this end, we developed a statetominimizethelossbetweenpredictedandground- differentiable non-Newtonian flow solver capable of han- truth velocity fields. During training, the loss decreases dling spatially varying viscosities (See Methods sec. B). by more than four orders of magnitude (Fig. 2b), indi- Builtwithinanautomatic-differentiationframework,the cating convergence to a consistent constitutive represen- solver provides exact gradients of any flow observable tation. The velocity field reconstructed with the trained with respect to model parameters, enabling end-to-end TBNN(Fig.2c,S2)isvisuallyindistinguishablefromthe optimizationthroughthefullsimulation. Ourimmersed- ground truth, with the axial velocity profile at the con- boundaryformulation[41]allowsustosimulatearbitrary striction throat (x=4) showing near-perfect agreement. geometries and boundary conditions, enabling training These results demonstrate that a geometry-agnostic, in- directlyoncomplexorexperimentallyreconstructedflow variantneuralrepresentationcanrecoverthecorrectcon- domains. This differentiable formulation thus forms the stitutive mapping purely from complex flow data. foundation for data-driven inference of constitutive laws ToevaluatewhetherthetrainedTBNNactsasatrans- from flow data in complex and experimentally relevant ferableconstitutivemodel,wenexttestitsabilitytopre- geometries. dict flows in conditions outside the training domain. We In principle, one could recover constitutive behavior embed the trained model and the corresponding ground- by selecting a candidate model, embedding it in the dif- truth CY fluid in a new geometry and increase the ferentiable flow solver, and optimizing its parameters to nondimensional pressure gradient to G = 7.5 (Methods match the observed flow. However, testing each model Sec. B). The TBNN-predicted velocity field (Fig. 3a) separately would require repeated expensive gradient- closely matches the ground-truth simulation (Fig. S3). based simulations and is therefore computationally inef- Fig. 3b shows the relative error (31) between the pre- ficient. Instead,weemployatensorbasisneuralnetwork dictedandtruevelocityfieldsbinnedbylocalstrainrate (TBNN) to learn the stress–strain-rate relationship di- (Methods Sec. C), demonstrating uniformly low error --- Page 4 --- 4 FIG. 2. Learning a tensor basis neural network closure for stress. (a) Ground-truth steady-state x-velocity for pressure-driven flow through a constriction (pressure gradient G = 5). (b) Training loss versus iteration (c) Steady-state x- velocity predicted by the simulation with the trained TBNN. (d) x-velocity at the constriction throat (x=4). across all strain rates, with the smallest deviations in structure and constitutive mapping with low relative er- the range 10−1 < γ˙ < 101, where the training signal is ror, underscoring that a differentiable fluid solver pro- strongest and most abundant. vides strong physical regularization and enables learning We also verify that these results are robust to noise even from coarse or noisy data (see Sec. D for detailed and degraded resolution (Methods Sec. C), demonstrat- discussion). ing that accuracy is maintained even with an over ten- fold decrease in resolution (Fig. S4) and with correlated, heteroskedastic velocity-field noise as high as 4% of the MODEL INTERPRETATION AND DISCOVERY 95th-percentileflowvelocity(Figs.S5–S6). Despitethese FROM THE TBNN degradations,thetrainedTBNNrecoversthecorrectflow Beyond predictive accuracy, a key advantage of our framework is interpretability: the trained TBNN can be interrogated to reveal the constitutive behavior it has learned and to identify classical models that best de- scribe it. To accomplish this, we employ a differentiable model-fitting method (Fig. 1, bottom panel) that probes the trained TBNN under controlled deformation histo- ries. In this setup, we apply prescribed kinematic forc- ings and compute the corresponding stress response pre- dicted by the TBNN. Because this procedure evaluates the constitutive mapping directly without solving a full flow problem, it enables rapid exploration of parameter FIG. 3. Flow prediction in an unseen geometry. (a) space and extrapolation to flow conditions beyond those Steady-state x-velocity prediction for pressure-driven flow in used in training. We then fit a library of standard rhe- a bidisperse porous medium with G=7.5. (b) Relative error ological models to the TBNN-generated stress data and comparedtogroundtruth,binnedasafunctionoflocalstrain selecttheonethatprovidesthebeststatisticalagreement rate. using the Bayesian Information Criterion (BIC). --- Page 5 --- 5 FIG.5. Demonstration of fitting different constitutive models to the same ground-truth data. We simulate rheometerdatausingthesameforcingfunctionsdescribedin thetext,takingthestrainrateasthecontrolledquantityand measuringtheresultingshearstressinaGiesekusmodel. We FIG.4. ExtractedCarreau–Yasudaparametersfroma fitseveraldifferentconstitutivemodels tothisdataandthen TBNN.(a)Representativeoscillatoryforcing: TBNNshear- examine how they perform when predicting the shear stress stress output (points) with the best-fit Newtonian response response under a new forcing that was not included in the (dashed) and Carreau–Yasuda (CY) response (solid) fit to fitting data. This new forcing and ground-truth response are the same trace; the CY model follows the waveform closely shown in the top panel. In the bottom panel we show the whiletheNewtonianfitmissestheextrema. (b)Parityplotof response of the different best-fit models to this new forcing. theshear-thinningexponentnlearnedfromtheTBNNversus ground truth across eight runs; dashed line indicates y = x. (c) Parity for the onset timescale k on log–log axes; points fallontheidentityovermorethananorderofmagnitude. In spectively. For each case, we also vary the transition pa- theserunsη 0wasfixed,andaandη ∞areweaklyconstrained; rameterk,whichdeterminestheshearrateatwhichthin- numerical values for all parameters, the best-fit Newtonian ningbegins. TheCYparametersrecoveredfromthedig- viscosity,andmodelcomparisonstatisticsaregiveninTableI. ital rheometer closely match the corresponding ground- AcrossallrunstheCYmodelisverystronglyfavoredbyBIC truth values across all cases (Table I). To visualize the (∆BIC=BIC N−BIC CY≫0). consistency of parameter recovery, Fig. 4b shows the similarity between the learned and true values of n and k, demonstrating that the TBNN accurately reproduces We first apply this procedure to the TBNN trained both the magnitude and trend of the shear-thinning re- on the constriction–expansion flow of Fig. 2. Using sponse. Finally, to demonstrate that the digital rheome- the digital rheometer (Methods Sec. D, we impose si- ter is not limited to interpreting learned models but also nusoidal shear-rate forcings with amplitude f = 10 and enablesdirect modelselectionfromexperiments,wenext frequency ω = 1 and record the corresponding stress re- apply the same tool to noisy bulk rheometer data across sponsepredictedbytheTBNN.WethenfitbothNewto- viscoelastic model families. nian and Carreau–Yasuda (CY) models to the resulting stresscurves(Fig.4a). TheNewtonianmodelfailstore- produce the nonlinear features of the response, whereas MODEL SELECTION FROM BULK theCYmodelcapturesthemaccurately,yieldingparam- RHEOMETRY eter values that closely match those used in the origi- nal simulation (first row of Table I). Comparison of the We now apply the same digital rheometer framework Bayesian Information Criterion (BIC) further confirms directly to noisy bulk rheometer data to identify consti- thattheCYmodelprovidesasubstantiallybetterstatis- tutive models and recover parameters across viscoelastic ticaldescriptionofthelearnedconstitutivebehaviorthan families. In contrast to the TBNN setting, here the in- the Newtonian model, despite having more parameters. put is a time series of imposed shear rates and measured WethenrepeatthisanalysisforsixadditionalTBNNs stresses, and we fit candidate constitutive laws via dif- trained on fluids with varying degrees of shear thinning, ferentiable ODE solvers (Methods Sec. D). This retains using power-law exponents n = 0.6 and n = 0.8 to rep- physical interpretability while leveraging gradient-based resent stronger and weaker shear-thinning behavior, re- efficiency for statistical model comparison (BIC) under --- Page 6 --- 6 Carreau–Yasuda parameters Run Source η ∆BIC s η η k n a 0 ∞ GT 1.000 0.020 5.000 0.700 2.000 1 0.340 915.35 Learned 0.985 0.021 4.941 0.701 1.615 GT 1.000 0.015 3.000 0.600 2.000 2 0.295 814.99 Learned 0.972 0.017 3.031 0.615 2.360 GT 1.000 0.012 1.000 0.600 2.000 3 0.456 434.86 Learned 0.992 0.013 0.983 0.639 1.011 GT 1.000 0.010 7.000 0.600 2.000 4 0.231 221.63 Learned 1.037 0.010 6.626 0.602 2.067 GT 1.000 0.040 5.000 0.800 2.000 5 0.495 526.63 Learned 1.018 0.040 4.820 0.792 2.018 GT 1.000 0.045 10.000 0.800 2.000 6 0.441 670.03 Learned 1.020 0.045 9.623 0.793 2.011 GT 1.000 0.050 15.000 0.800 2.000 7 0.416 555.15 Learned 1.022 0.050 14.404 0.795 2.021 TABLE I. Model extraction from TBNN. For each run, ground-truth (GT) Carreau–Yasuda (CY) parameters and CY parameters fitted to the TBNN output (Learned). η N is the best-fit Newtonian viscosity to the same TBNN output. ∆BIC≡ BIC Newtonian−BIC CY (positive favors CY). experimental noise. between the different physical models. While recent data-driven approaches successfully The results of this test are summarized in Fig. 6(a). model rheometer data with neural networks, these mod- Without optimizing the initial guesses or optimizer pa- els often rely on thousands of non-physical parameters, rameters for a given model, our approach is able to cor- making them computationally expensive and difficult to rectly identify the ground truth model nearly all of the interpret. Furthermore, the flow protocols probed by timeinthecaseofthesimplestmodelsandupto70%of standard rheometric measurements are typically simple the time for the most complicated model, Linear PTT. and low-dimensional, meaning that such complex mod- We can understand the failure cases in more detail by els are not always warranted by the information con- looking at where in the sampled parameter ranges our tent of the data. As an alternative, we demonstrate approach failed. In Figs. 6(b) and (c) we plot a key how combining classical, physically-grounded constitu- parameter from each of the two models with less than tive laws with differentiable programming provides an 90% identification accuracy. We see that in all three efficientandphysicallyinterpretabletoolforfittingmod- cases consistent failure, as denoted by the red symbols, elstobulksheardata. Fig.5illustratesthisworkflowon is associated with strong clustering at particular values synthetic rheometer data, where several candidate mod- of the parameters. This indicates that our methodology els are fit to a single ground-truth dataset to determine cannot distinguish the underlying behavior of the model the best match. These statistical comparisons also serve from other constitutive laws in these regimes. as a necessary first step for assessing whether conven- While this may seem to be cause for concern, it in- tional constitutive models are sufficient or whether more dicates an important factor in Bayesian analysis, which expressive data-driven formulations are required. is that our predictions are conditioned on the particular To test the ability of differentiable programming to choice of forcing function. In this case, we generally fol- identify rheological models from data, we generated lowedtheprotocolforfittingrheometer-likedatalaidout noisy synthetic rheometer data for 100 random instan- in other data-driven approaches [26] while adding addi- tiations across five common constitutive models (Newto- tionalamplitudestoextendtherangeofshearstressesob- nian, Carreau-Yasuda, Oldroyd-B, Giesekus, and Linear servedinthedata. Forthisparticularsetofforcings,that PTT). We then fit each dataset with all five candidate the underlying constitutive behavior is indistinguishable models, using a differentiable ordinary differential equa- fromothermodels, illustratingtheimportanceofexperi- tion solver to perform the fitting via gradient descent mentaldesignandhowinsufficientlyinformativeforcings (see Materials and Methods for details). We selected the can make distinct models indistinguishable. best-fit model using the Bayesian Information Criterion Onceaparticularmodelhasbeenidentified,theresult- (BIC), which penalizes models with more parameters. ing fit can be used to estimate the material properties of Our approach proved highly effective at distinguishing the fluid. We summarize the geometric median factor --- Page 7 --- 7 FIG. 6. Model selection and parameter identification.(a) Confusion plot of our model-fitting approach when tested against 100 random instantiations of five common constitutive models, demonstrating that our approach achieves high fitting accuracy for all but the most complicated models. Looking at the worst fit models, we observe that when plotting the success versusfailurefordifferentparametersin(b)and(c)thatthemisidentificationisstronglycorrelatedwithdifferentregimesofa keyparameter. Wehypothesizethatthisislikelyduetoanon-optimalsetofforcingfunctionswhichdonotadequatelysample the parameter space. TABLEII.Geometricmedianfactor(estimate/true)foreachparameterbymodel. Values<1indicatemedianunderestimation; >1overestimation. Foralmostallmodelsourmethodcamewithinonepercentofthetruevalue. InthecaseofCarreau-Yasuda, our method produced reasonable parameter estimates, though some deviation may be due to forcing functions which do not adequately sample the shear-thinning regime of such models. Newtonian Carreau-Yasuda OldroydB Giesekus LinearPTT η 1.000 — 1.000 1.000 1.000 s η — — 1.000 1.000 0.919 p λ — — 1.000 1.000 0.910 α — — — 1.000 — η — 1.042 — — — 0 η — 1.221 — — — ∞ a — 0.882 — — — k — 1.100 — — — n — 1.006 — — — ζ — — — — 1.001 ϵ — — — — 0.997 (the ratio of the estimate to the true value) for each pa- rates, making it difficult to converge on specific values rameter by model in cases where the correct model was given the choice of optimizer settings. identified in table II. For almost all of the models, the For any non-linear fitting approach, choosing the cor- median factor was very nearly one, indicating low uncer- rect hyperparameters is critically important to achieve tainty in the fit. Most models did have a few outliers, goodconvergence. WhenwerepeatedtheCarrea-Yasuda where the predictions were off by over 100%. This gen- parameteridentificationexperimentonanewsetofsam- erally correlated strongly with very small values of the ples with slower hyperparameter (as described in Meth- parameters, where the learning rate of the optimizer is ods) the median error factor decreased to at most 1.003 not tuned well to converge on these values. for all parameters except for η . Our differentiable ap- ∞ proach still systematically overestimated η due to the While most models have parameter predictions within ∞ lack of high shear rates sampled in the data set. 10%, Carreau-Yasuda type models somewhat underper- formedintermsofparameteridentification. Thisislikely Together, theseresultsdemonstratethatdifferentiable due to there being a limited range of shear rates present model fitting can robustly identify constitutive laws and inourdata. Inparticular, wecanseethatthezeroshear parameters when the data are informative. Just as im- rate shear-thinning exponent is fit with relatively little portantly, they reveal that model identifiability is ulti- uncertainty but the other parameters are less accurate. matelylimitedbytherichnessoftheexperimentalproto- Given the sinusoidal nature of our test forcings, the op- col, underscoring the need to deliberately design forcing timizer sees very few data points at relatively high shear functions that probe the relevant rheological regimes. --- Page 8 --- 8 DISCUSSION AND CONCLUSION late them into new analytical forms. Conversely, the samedifferentiableinfrastructurecanperforminversede- sign,optimizingmodelormaterialparameterstoachieve This work establishes a framework for learning consti- a target system behavior. tutivebehaviordirectlyfromflowmeasurementsthrough Together, these results mark a step toward automated differentiable simulations. By embedding the non- rheological characterization. Differentiable simulations Newtonian stress within a fluid solver, we demonstrated unifymeasurement, modeling, andoptimizationinasin- that constitutive laws can be inferred from sparse, noisy, gle framework that learns, tests, and designs models or indirect observations – turning rheological inference in silico. By making constitutive inference both inter- into a gradient-based optimization problem. The ability pretable and programmable, we envision this approach of the tensor basis neural network (TBNN) to recover laysthefoundationfordata-drivenyetphysics-grounded thecorrectstressresponsefromlimiteddataunderscores exploration of complex fluids and, ultimately, for self- thatthegoverningequationsthemselvesprovideapower- driving rheology experiments. fulinductivebias: physicalstructurereducestheneedfor largedatasetsandincreasesrobustnesstonoise,enabling thelearneddata-drivenconstitutivemodeltobedirectly interrogated and compared against classical laws. MATERIALS AND METHODS At the same time, our results reveal fundamental lim- itations of conventional bulk model fitting. Even for A. Governing equations simple shear-thinning fluids, reliable parameter identi- fication depends critically on the richness of the applied We model incompressible, time-dependent flow with forcing. Classical Carreau-Yasuda fits assume shear rate the Cauchy momentum balance and a general deviatoric sweeps spanning several orders of magnitude; when re- stress: stricted to narrower protocols, parameter estimates be- comedegenerateormisleading. Thisillustratesageneral ∇⋅u=0, (1) challengeinBayesianmodelselectionforrheology,where ρ(∂ u+(u⋅∇)u)=−∇p+∇⋅σ+f, (2) under-informative experiments, rather than model inad- t equacy, often dominate error. Neural network closures where u is velocity, p pressure, σ the deviatoric stress, wouldrequireordersofmagnitudemoreexposuretoflow and f an imposed body force (e.g., a uniform pressure diversity to achieve comparable fidelity. gradient or immersed boundary force). Becauseoursolverisfullydifferentiable,itoffersapath Constitutive laws and rheological models relate a toovercometheselimitsthroughoptimizedexperimental fluid’s stress tensor σ to the local rate-of-strain, D = design. The same gradients used to fit model parame- 1/2(∇u+(∇u)T). The simplest such model is a Newto- ters can quantify how informative a forcing protocol is, nian fluid, where the viscosity η is a simple scalar factor allowing one to design inputs that maximally discrimi- relating the two, nate between competing constitutive hypotheses or min- imize parameter uncertainty. In this sense, differentiable σ=2ηD. (3) rheometry can close the loop between experiment and model, automating what has historically been an intu- Increasing in complexity is a class of constitutive laws itive and labor-intensive process. known as Generalized Newtonian Fluids (GNFs). Such Beyond the velocimetry examples shown here, the fluids are characterized by a viscosity√η that becomes a framework generalizes naturally to any measurable flow function of the strain rate γ˙ =∣∣D∣∣≡ 2D∶D. One such quantity, such as tracer trajectories, pressure fields, model is a power-law fluid, with a viscosity η(γ˙) given flow-ratefluctuations,orcombinationsacrossconditions. by This flexibility allows it to serve as a framework to turn any measurement into a rheometer. Further, our η(γ˙)=Kγ˙n−1, (4) approach can enable construction of in-line or on-chip rheometersthatinferconstitutivebehaviordirectlyfrom where K and n are the consistency and shear-thinning process data, providing access to rheology in environ- index, respectively. Another such model is the Carreau– ments where sampling or laboratory rheometry would Yasuda model [4, 5], given by alter the material, such as emulsions, polymer melts, or multiphase suspensions. Implementing more complex n−1 physics, such as viscoelasticity and multiphase flows, is η(γ˙)=η ∞+(η 0−η ∞)[1+(kγ˙)a] a , (5) ongoingworkthatwillexpandthereachofthisapproach. Looking further ahead, we envision differentiable fluid wherek isthecharacteristictimescale,aisthetransition simulations combined with data-driven closures to en- sharpness, n is the shear-thinning index, and η and η 0 ∞ able model discovery when no classical constitutive law are the zero- and infinite-shear viscosity respectively. suffices: the TBNN can learn interpretable tensor bases, When studying polymeric fluids, consisting of a long whilesymbolicregressionorphysicalreasoningcantrans- polymer dissolved in a solvent, constitutive models are --- Page 9 --- 9 written in terms of an extra stress τ, such that the total tolerances on divergence and kinetic-energy drift, and fluid stress σ is given by boundary conditions are imposed either directly (no-slip walls, pressure inlets/outlets) or via IB forcing for com- σ=2η sD+τ. (6) plexgeometries. Weiterateresidualsuntil∥∇⋅u∥ 2<10−8 and relative changes in kinetic energy fall below 10−10. Here, η is called the solvent viscosity and describes the s All solver operations — state updates, pressure pro- Newtonian contribution to the stress. The simplest vis- jection, and non-Newtonian stress evaluation — are ex- coelastic model that is often used in describing fluids is pressed as pure JAX transformations, enabling exact the Oldroyd-B model [7], whose extra stress obeys an reverse-mode differentiation through the full computa- evolution equation tion. Sensitivities are propagated through each iterative τ▿+λτ =2η D, (7) updatewithoutanexplicitadjointPDEderivation,yield- p ing gradients of any scalar objective (e.g., velocity-field where losses) with respect to constitutive parameters or neural network weights. ∂τ τ▿= +u⋅∇τ −τ ⋅∇u−∇uT⋅τ, (8) This end-to-end differentiable pipeline provides the ∂t map from constitutive parameters to flow observables istheupper-convectedderivative,λistherelaxationtime and their gradients, and it is the backbone used to train and η p is the polymer viscosity. the tensor basis neural network (TBNN) closure. There are a number of additional terms which may be added to the Oldroyd-B model to account for additional physics. In this paper we will consider two additional models for viscoelastic polymer solutions, the Giesekus Solver validation model [9] whose extra stress evolves like αλ To validate the solver, we implemented classical τ▿+λτ + τ ⋅τ =2η D, (9) η p generalized-Newtonian models, where the local viscosity p is governed by the local strain rate, including the power- andtheLinearPhan–Thien—Tannermodel[8], givenby law and Carreau–Yasuda (CY) fluids. Both models were benchmarked against OpenFOAM simulations of steady τ◽+(1+ ελ tr(τ))τ =2η D. (10) Poiseuille flow, showing quantitative agreement in veloc- p η ity and pressure profiles. All training data used in this p work were thus generated by forward simulations from Here, our differentiable solver. τ◽=τ▿+ζ(τ ⋅D+D⋅τ) (11) is known as the Gordon-Schowalter derivative. Constitutive closure via a tensor basis neural network B. Differentiable non-Newtonian fluid solver While analytical constitutive models such as the power-law or Carreau–Yasuda form can be fit individ- Differentiable solver and numerics ually, doing so for every flow type or geometry rapidly becomescumbersomeandinflexible. Instead,weadopta We solve the incompressible equations in a differ- general tensorial representation of the stress based on a entiable JAX-based framework that follows established tensorbasisneuralnetwork(TBNN),whichexpressesthe components from JAX-CFD and immersed-boundary stressasasumoverinvarianttensorialbasesweightedby (IB) methods [40, 41]. At a high level, we use a stag- scalar functions of the flow invariants [26, 42]: gered Cartesian grid, second-order central differences for diffusive terms, a conservative upwind discretization for N advection, and a projection step that corrects a provi- σ(∇u)=∑α i(I)B i(∇u), (12) sional velocity via a pressure Poisson solve to enforce i=1 ∇⋅u=0. Spatially varying viscosity introduces significant ad- where α i(I) are scalar coefficient functions of an invari- ditional stiffness that standard explicit schemes cannot ant set I = {I 1,I 2,...,I K}, and B i are tensor bases handle. To address this, we extended the solver to sup- formed from ∇u and its symmetric and antisymmetric port fully implicit (backward Euler) integration for wall- parts. Thisconstructionguaranteesframeinvarianceand boundedflowsandsemi-implicit(IMEX)schemesforun- provides a systematic, data-driven extension of classical bounded or periodic domains. The resulting linear sub- constitutive laws. problems are solved iteratively (BiCGSTAB) to tight Fortwo-dimensionalincompressibleflow,thecomplete --- Page 10 --- 10 basis set reduces to stated, the zero-shear viscosity is fixed at η =1 and the 0 reference pressure gradient at G =1. ref D= 1(∇u+∇u⊺), (13) All training is performed in the constriction geometry, 2 W= 1(∇u−∇u⊺), (14) where the reference length corresponds to the gap width 2 H =1, and the imposed nondimensional pressure gra- gap I 1=tr(D2), I 2=tr(W2), (15) dient is G∗ = G/G ref = 5. As a generalization test, we B =D, B =WD−DW. (16) additionally evaluate the trained model in a bidisperse 1 2 porous-medium geometry, where H is taken as the ra- ref BecausethetrainingdataaregeneratedfromtheCar- dius of the larger circular obstacle and the imposed gra- reau–Yasuda model, which produces purely extensional dient is G∗=7.5. stresses without rotation-induced components, we omit the second invariant and the antisymmetric basis. We verified this approximation by including the full set of C. Learning and evaluation protocol for the TBNN basesandinvariantsinaseparatetraining,whichlearned nearly zero dependence on the second invariant and an- Reference data and PIV emulation tisymmetric term, confirming that their contribution is negligible. Accordingly, the simplified closure used for Ground-truth fields are generated by forward simula- the final results still adheres to the TBNN framework tions of the Carreau–Yasuda model. For Figs. 2 and 4, while reducing to a generalized-Newtonian form with a wetraindirectlyonthenativesimulationgrid(noobser- data-driven viscosity: vation operator). To mimic experimental measurements in Figs. S4–S6, σ=2η(I )D, (17) 1 we apply a PIV observation operator that first performs Hann-windowed, separable smoothing over interrogation We parameterize η with a monotone, bounded head windows and then samples at vector-center locations: whoseparametersaregeneratedbyaneuralnetworkover invariants. y=SHu + ε, (21) true η where H denotes Hann-windowed averaging and S de- η(I )=η [1+r(1−F(I ))], r≡ 0 −1, (18) 1 ∞ 1 η notes sampling on the coarser PIV grid. √ ∞ The measurement noise ε is correlated and het- 2I z(I )≡log( 1), (19) eroskedastic. Correlation is introduced by a separable 1 γ˙ ref Gaussian smoothing on the vector grid with widths tied M z(I )−µ (I ) to the interrogation-window geometry: F(I )= ∑ α (I )sigm( 1 m 1 ), M =12, 1 m=1 m 1 s m(I 1) ε=Σ(x) ⊙ (G∗ξ) + ς bias(G∗b), ξ∼N(0,I), (20) (22) where F is a mixture of M=12 logistic modes, with W W sigm(x) = 1/(1 + e−x). The mode parameters G =G(ς x,ς y), ς x= 21χ corr sx, ς y = 21χ corr sy , {α (I ),µ (I ),s (I )} are produced by a 16-unit x y m 1 m 1 m 1 (23) Multi-LayerPerceptron(MLP),withα normalizedand m s m > 0, yielding a total of 646 trainable parameters. with W x,W y the interrogation-window sizes and s x,s y In these expressions, η and η denote the zero- and the strides (vector spacings). The nondimensional factor 0 ∞ infinite-shear viscosities, respectively, and γ˙ ref is a fixed χ corr setsthecorrelationwidthofthesyntheticnoiserel- referenceshear-ratescaleusedfornondimensionalization, ative to the vector spacing, and ς x,ς y are the Gaussian which we set as γ˙ =1.0. smoothingwidthsappliedalongeachaxisofthePIVvec- ref This form ensures positivity of η while allowing suffi- tor grid. cient flexibility to capture nonlinear shear-thinning and Heteroskedasticity is modeled by a spatially varying thickening responses, providing a smooth, differentiable scale field constitutive closure compatible with the TBNN frame- Σ(x)=ς [1+β Ĝ(x)], ς =αU , (24) base ∇ base 95 work. where U is the 95th-percentile speed on the downsam- 95 ̂ pled field, G is a normalized speed-gradient magnitude Nondimensionalization and units on the vector grid, and ς adds a low-frequency back- bias ground offset via the same kernel G. All quantities are reported in pressure-driven viscous For runs where we explicitly decreased resolution units. Lengths are scaled by a characteristic length scale and/or added noise, we used a Hann kernel for H, fixed H , velocities by U = G H2 /η , times by T = χ = 0.35, β = 0.5, and ς = 0.1ς , while vary- ref ref ref ref 0 ref corr ∇ bias base η /(G H ), stresses and pressures by τ = G H , ing the interrogation-window size (and thus the effective 0 ref ref ref ref ref and shear rates by γ˙ = G H /η . Unless otherwise vector spacing) and the noise amplitude α. ref ref ref 0 --- Page 11 --- 11 Training objective and schedule Evaluation metrics We train the TBNN closure by matching the observed Except for the training loss, all evaluation metrics are velocity field—either the full simulation grid or its PIV- computed against the ground-truth simulation fields, not processed counterpart—while applying mild regulariza- the window-averaged or noisy observations. tion. Let u be the solver output and O ∈ {Id,SA} InFig.3,wereportastrain-rate–binnedrelativeerror, pred the observation operator (identity for full-grid train- which quantifies the pointwise deviation normalized by ing;downsampledwindow-averagingforPIV).Thedata- the local ground-truth velocity magnitude and averaged fidelity term is within bins of strain rate: L = 1 N ∑obs ∥(Ou )(x )−y(x )∥2 , (25) RelErr(γ˙)=⟨∥u pred(x)−u true(x)∥ 2⟩ . (31) data N pred j j 2 ∥u (x)∥ obs j=1 true 2 γ˙bin where, for training directly on the simulation grid, y = In Figs. S4a and S5a, we report the domain-level rela- u . true tive root-mean-squared error (RRMSE), which measures Ascale-invariantshapetermemphasizesmatchingflow the global difference between predicted and true velocity patterns independent of magnitude: fields across all grid points: N ∑obs ∥(Ou pred)(x j)−y(x j)∥2 2 RMSE =⎛ 1 N ∑grid ∥u (x )−u (x )∥2⎞1/2 , L shape= j=1 Nobs . (26) u ⎝N grid j=1 pred j true j 2⎠ ∑ ∥y(x )∥2 j 2 (32) j=1 RMSE The viscosity-head prior discourages (i) excessive RRMSE = u . (33) shear-thinning and (ii) overly bumpy profiles in log- u ( 1 ∑Ngrid∥u (x )∥2)1/2 viscosityspaceinordertokeeptheparameterssuchthat Ngrid j=1 true j 2 the forward simulation is stable: The strain-rate–binned relative error (Fig. 3b) high- lights local performance across different flow regimes, 1 Nz 2 L = ∑(max{0, ∣∂ logη(z )∣−s }) , whereas the RRMSE (Figs. S4a and S5a) provides a slope z q th N z q=1 single aggregate measure of overall predictive accuracy. s =0.5, (27) th 1 Nz 2 D. Differentiable model fitting L = ∑(max{0, ∣∂ logη(z )∣−c }) , (28) curv zz q th N z q=1 Model simplification √ with z =log( 2I /γ˙ ) and a curvature threshold c = 1 ref th 1.0. In practice, the slope and curvature penalty was The Oldroyd-B type models are all partial differen- identically zero in nearly all runs. tial equations that depend on space and time. However, The total objective is when fitting to one-dimensional shear rheometer data, we can simplify these models into ODEs following the L=λ L +λ L (29) example of [26] by assuming that since the flow should data data shape shape +λ slopeL slope+λ curvL curv, (30) be purely azimuthal u = ze θ while varying only in the vertical direction, the stress σ should also have no vari- where λ = 1, λ = 0.1, λ = 10−3, and λ = ations in the azimuthal direction. This means that the data shape slope curv 10−4. terms u⋅∇τ = u⋅∇D = 0 and D becomes independent We employ a two-stage training schedule. In the first of any spatial coordinates, leaving the extra-stress equa- stage, the network weights are held fixed while η is ad- tion as an ODE only in terms of time. This assump- ∞ justeduntilthesignofitsgradientflips(typicallywithin tion inherently assumes that the Weissenberg number is 8–12 iterations). In the second stage, η is frozen and small enough that out-of-plane instabilities do not de- ∞ thecurvatureandshapeparametersoftheviscosityhead velop, which would break the assumption of spatial ho- aretrained. ToavoidrapidconvergencetoatrivialNew- mogeneity. tonian local minimum that lowers the loss, we fix η =1 0 throughout training. In practice, η could be treated as 0 a hyperparameter or unfrozen after convergence of the Rheometric fitting second stage. For runs 2 and 3 in Table I, training was morestablewhenthemixturecentersinF(I )werealso Given that the shear rheometer forms the backbone of 1 held fixed. most laboratory experiments in complex fluids, we first --- Page 12 --- 12 explore how differentiable solvers enable fitting models a handful of parameters, enabling us to efficiently fit an tobulkrheometerdata,inlinewithpreviousdata-driven ensemble of potential models to the same dataset. As- approaches to the same topic [26]. In particular, we as- suming that the errors in the fit are independent and sume that the Weissenberg number is small enough that normally distributed, the log-likelihood of the particular the flow in the rheometer gap becomes approximately estimate is given by two dimensional and spatially homogeneous. The result isthatconstitutivelawscanbereducedtoordinarydiffer- Lˆ =−N (ln(2πL)+1), log-like ential equations only in terms of time that are expressed 2 termsoftherateofstraintensorDandthestressσ,with where L is the mean squared error defined in Eqn (34). no direct appearance of the flow u. The Bayesian information criterion for a particular fit to Under the quasi-two-dimensional flow assumption of a shear rheometer, the gradient of the flow ∇u = γ˙(t)e a model is then 12 only has one non-zero component in the shear direc- BIC=kln(N)−2Lˆ . (35) tioncharacterizedby apotentiallytime-dependent shear log-like rate γ˙, which is spatially homogeneous across the entire Here, k represents the number of parameters in the par- rheometer. Inashearrheometer,thisshearrateγ˙ maybe ticular model, which is given simply as the length of the prescribedandtheresultingshearstressσ measuredby 12 vector θ. Under a Bayesian framework, the model which averagingthetorsionalresistanceencounteredbythetop bestdescribesthesystemgiventheobserveddata hasthe plate. Alternatively, the shear stress may be prescribed smallest BIC, a measure which naturally penalizes more and the strain measured directly. We will use the former complicated models with higher degrees of freedom. case, though the approach would work equally well in the latter case. While the shear strain is assumed to be unidirectional, the stress σ has six independent compo- Model fitting protocol nents which can be non-zero due to non-linear coupling between the different stress terms in viscoelastic consti- We apply this approach by generating 100 random tutive laws. modelsforeachofNewtonian,Carreau-Yasuda,Oldroyd- Under our previous assumptions, for a particular con- B, Giesekus, and Linear PTT constitutive laws by ran- stitutive model we simulate the stress response to a par- domlysamplingmaterialparametersforeachmodel. The ticular strain rate γ˙ by integrating the model forward in exactrangesofmaterialparametersweusedforthissam- time to obtain all six stress terms for a given set of ma- ple are given in Table S1. We then generate a set of terial parameters. While this can be done for arbitrary groundtruthdataforeachmodelbysimulatingsynthetic choicesofmaterialparameters,wearemostinterestedin shear stress data under the forcing function using this framework to fit models to experimental data. In this case, most experimental data takes the form of a γ˙ =fsin(ωt) (36) measured shear stress, σˆ (t ), while the other five com- 12 n ponents of the ground truth are unknown. Here the t n for every combination of f ∈ [0.01,0.1,1.0,10.0] and arediscretemeasurementtimes. Thestandardlossfunc- ω ∈ [0.33,1.0,2.0]. We add Gaussian noise with an am- tion for fitting this data is the mean squared error or plitude of 0.03 onto the ground truth data to simulate experimental uncertainty. We fit this ground truth data 1 N L= ∑(σˆ (t )−σ (t ;θ))2, (34) back onto each of the five models, with initial guesses 12 n 12 n N n=1 of one for each material parameter. We used an ADAM where σ is our predicted shear stress and θ the vec- optimizer to perform the non-linear optimization with a 12 torofmaterialparametersthatdefinesthemodel. Thus, learningrateof0.1over1000epochs. Anexampleofthis fitting a given model to the data takes the form of a fitting process is shown in Fig. 5 for a set of Giesekus non-linear minimization problemover θ, where themini- ground truth data. mization must be performed through the solution to the WererantheCarreau-Yasudaparameteridentification ODE which governs σ for a given γ˙. tests on a new sample of 24 models with a learning rate 12 Weperformtheintegrationusingadifferentiablesolver of 0.001 and 50,000 epochs, which led to much better Diffrax [45], which allows us to automatically take gra- convergence onto the ground-truth parameters. dients of the loss function, Eqn (34), with respect to the parametersθ. Wecanusegradient-descentalgorithmsto efficiently find a set of parameters θ that best describe ACKNOWLEDGMENTS the data by minimizing the loss. This approach mirrors that used by neural network We thank Kaylie Hausknecht, Randy Ewoldt, Gareth data-driven approaches which rely on very large (on the McKinley,DaveWeitzandKaushikBhattacharyaforim- order over 1,000 to 10,000) numbers of parameters to fit portantdiscussions. ThisworkwassupportedbytheOf- the data, resulting in large computation times. We in- fice of Naval Research (ONR N00014-23-1-2654) and the stead fit the data to classical constitutive models, which NSF AI Institute of Dynamic Systems (2112085). --- Page 13 --- 13 [1] H.A.Barnes,inRheologyreviews(BritishSocietyofRhe- [31] M. Mahmoudabadbozchelou, K. M. Kamani, S. A. ology, 2003) pp. 1–62. Rogers, and S. Jamali, Proceedings of the National [2] P.R.DeSouzaMendesandR.L.Thompson,Journalof Academy of Sciences 121, 10.1073/pnas.2313658121 Non-Newtonian Fluid Mechanics 260, 104933 (2018). (2024). [3] R. B. Bird, R. C. Armstrong, and O. Hassager, Dynam- [32] S. Shanbhag and G. Erlebacher, Physics of Fluids 36 ics of polymeric liquids, Vol. 1: Fluid Mechanics (John (2024). Wiley & Sons, 1987). [33] T.Sato,S.Miyamoto,andS.Kato,JournalofRheology [4] P. J. Carreau, Transactions of the Society of Rheology 69, 15 (2025). 16, 99 (1972). [34] M.Raissi,P.Perdikaris,andG.E.Karniadakis,Journal [5] K. Yasuda, R. Armstrong, and R. Cohen, Rheologica of Computational physics 378, 686 (2019). Acta 20, 163 (1981). [35] A. M. Tartakovsky, C. O. Marrero, P. Perdikaris, G. D. [6] W. H. Herschel and R. Bulkley, Kolloid-Zeitschrift 39, Tartakovsky, and D. Barajas-Solano, Water Resources 291 (1926). Research 56, e2019WR026731 (2020). [7] J.Oldroyd,ProceedingsoftheRoyalSocietyA200,523 [36] B. Reyes, A. A. Howard, P. Perdikaris, and A. M. Tar- (1950). takovsky, Physical Review Fluids 6, 10.1103/physrevflu- [8] N. Phan-Thien and R. I. Tanner, Journal of Non- ids.6.073301 (2021). newtonian Fluid Mechanics 2, 353 (1977). [37] S. Thakur, M. Raissi, and A. Ardekani, Journal of Non- [9] H.Giesekus,JournalofNon-NewtonianFluidMechanics Newtonian Fluid Mechanics 325, 105100 (2024). 11, 69 (1982). [38] D. N. Simavilla, A. Bonfanti, I. Garc´ıa-Beristain, [10] J. Marchal and M. Crochet, Journal of Non-newtonian P. Espan˜ol, and M. Ellero, Journal of Fluid Mechanics Fluid Mechanics 26, 77 (1987). 1016, A11 (2025). [11] W. Lunsmann, L. Genieser, R. Armstrong, and [39] A. Kontogiannis, R. Hodgkinson, S. Reynolds, and R.Brown,Journalofnon-newtonianfluidmechanics48, E. Manchester, Journal of Fluid Mechanics (Rapids) 63 (1993). 1011, R3 (2025). [12] F. Debae, V. Legat, and M. Crochet, Journal of Non- [40] D. Kochkov, J. A. Smith, A. Alieva, Q. Wang, M. P. newtonian Fluid Mechanics 51, 257 (1994). Brenner, and S. Hoyer, Proceedings of the National [13] M. M. Denn, Annual Review of Fluid Mechanics 22, 13 Academy of Sciences 118, e2101784118 (2021). (1990). [41] M. G. Alhashim, K. Hausknecht, and M. P. Brenner, [14] J. Freund and R. Ewoldt, Journal of Rheology 59, 667 Proceedings of the National Academy of Sciences 122, (2015). e2403644122 (2025). [15] A. J. Liu and S. R. Nagel, Nature 396, 21 (1998). [42] J. Ling, A. Kurzawski, and J. Templeton, Journal of [16] P. Coussot, Soft Matter 3, 528 (2007). Fluid Mechanics 807, 155 (2016). [17] J. P. Rothstein and G. H. McKinley, Journal of Non- [43] J.Boyd,J.M.Buick,andS.Green,PhysicsofFluids19 Newtonian Fluid Mechanics 86, 61 (1999). (2007). [18] D.F.James,JournalofNon-NewtonianFluidMechanics [44] S. Lynch, N. Nama, and C. A. Figueroa, Scientific Re- 157, 91 (2009). ports 12, 20568 (2022). [19] L. Boyko, P. Abbasi, S. Movchan, G. D’Avino, [45] P. Kidger, On Neural Differential Equations, Ph.D. the- M.Manna,S.Haward,A.Shen,andV.Steinberg,Jour- sis, University of Oxford (2021). nal of Fluid Mechanics 908, A20 (2021). [20] E.J.Hinch,JournalofNon-NewtonianFluidMechanics 324, 105179 (2024). [21] J. M. Dealy, Journal of Rheology 39, 253 (1995). [22] R.H.Ewoldt,A.E.Hosoi,andG.H.McKinley,Journal of Rheology 52, 1427 (2008). [23] G.H.McKinleyandT.Sridhar,AnnualReviewofFluid Mechanics 34, 375 (2002). [24] C.J.Pipe,T.S.Majmudar,andG.H.McKinley,Rheo- logica Acta 48, 621 (2009). [25] S. J. Haward, M. S. N. Oliveira, M. A. Alves, and G. H. McKinley, Physical review letters 109, 128301 (2012). [26] K. Lennon, J. Rathinaraj, and J. Swan, Proceedings of the National Academy of Sciences 120, e2304669120 (2023). [27] M. Saadat, M. Mahmoudabadbozchelou, and S. Jamali, Rheologica Acta 61, 721–732 (2022). [28] D. Dabiri, M. Saadat, D. Mangal, and S. Jamali, Rheo- logica Acta 62, 557–568 (2023). [29] K. H. Ahn and S. Jamali, Rheologica Acta 62, 473–475 (2023). [30] M.MahmoudabadbozchelouandS.Jamali,ScientificRe- ports 11, 10.1038/s41598-021-91518-3 (2021). --- Page 14 --- 14 SUPPLEMENTARY INFORMATION 1. Effect of training data resolution and noise Experimental flow measurements are typically lower in resolution and contain structured uncertainty. To assess howsuchfactorsinfluencelearning,wesyntheticallydegradethetrainingdatatomimicmicro-PIVconditions(Meth- ods Sec. C). Specifically, the velocity field is down-sampled by Hann-windowed averaging over square interrogation windows of width W , and measurement noise ε is added according to the correlated, heteroskedastic model de- win scribed in the Methods. The noise amplitude scales with the 95th-percentile velocity U , and higher-shear regions 95 receive proportionally larger perturbations, reproducing the anisotropic error structure of experimental velocimetry measurements. We first examine the effect of spatial resolution by varying W while keeping the noise parameters fixed. As win shown in Fig. S4a, the trained TBNN maintains its predictive accuracy, quantified by the relative root-mean-squared error(RRMSE ),evenwhentheresolutionisreducedto13×13interrogationwindows. Thisrobustnessdemonstrates u that spatially coarse flow measurements remain highly informative, containing sufficient kinematic diversity to re- cover the underlying constitutive behavior, far beyond what is accessible from traditional bulk rheometry. Example downsampled reconstructions are shown in Fig. S4b,c. We next examine the effect of measurement noise using the same correlated, heteroskedastic model. Here the noise level on the horizontal axis of Fig. S5a is defined as the amplitude of the base scale σ = αU , expressed as a base 95 percentage of the 95th-percentile velocity magnitude U . As the noise amplitude increases, the RRMSE between the 95 TBNN prediction and the ground-truth field rises slightly but remains low, even for perturbations as large as 4% U . Although the total loss cannot decrease as much in these cases, reflecting the irreducible mismatch introduced 95 by measurement noise (Fig. S6a), the trained model still captures the underlying flow structure with high fidelity (Fig. S6b). This robustness underscores a key advantage of our differentiable formulation: by enforcing the governing equationsashardconstraints,themodelresistsoverfittingnoisydataandinsteadconvergestothephysicallyconsistent constitutive relation, even when the available information is degraded. SUPPLEMENTARY FIGURES FIG.S1. Examplekinematicandrheologicalfieldsusedfortraining. (a)Localstrain-ratemagnitudelog (γ˙)showing 10 the broad range of kinematic conditions sampled within the constriction geometry for a shear-thinning fluid with parameters η 0=1.0,η ∞=0.02,k=5.0,n=0.7,anda=2.0. (b)Correspondingviscosityfieldlog 10(η/η 0)fromtheCarreau–Yasudamodel, demonstrating a wide range of local viscosities and strong shear thinning in the throat region. --- Page 15 --- 15 FIG. S2. Velocity-field reconstruction and errors. Comparison between ground-truth and TBNN-predicted velocity componentsfortheconstrictiongeometry. (a,b)y-velocityfieldsshowingnear-perfectrecoveryofthecross-streamflowstructure (u ). (c,d)Absolutedifferencesforu andu (thecorrespondingground-truthandTBNNu fieldsareshowninFig.2ofthe y y x x main text), indicating very low absolute errors compared with the flow magnitude. FIG. S3. Generalization to unseen geometry. Comparison between TBNN predictions and ground-truth fields for flow through a bidisperse porous array. (a,b) Ground-truth and predicted u fields. (c) Absolute error in u . (d–f) Analogous x x comparison for u . The learned closure transfers successfully to an out-of-training pressure drive in a geometry with different y boundary conditions, preserving spatial structure and amplitude of both velocity components. --- Page 16 --- 16 FIG. S4. Robustness to coarse spatial resolution. (a) Relative root-mean-squared error (RRMSE ) of predicted velocity u fields as a function of synthetic PIV resolution, with error bars showing variation across three separate runs. (b,c) Example downsampled velocity inputs used in training from the finest (61×61) and coarsest (13×13) resolutions. Despite heavy down- sampling, the trained model captures the dominant flow structures and reproduces velocity magnitudes with very low global error. FIG. S5. Robustness to measurement noise. (a) RRMSE of TBNN-predicted velocity fields versus synthetic PIV u noise level, with error bars showing variation across five separate runs except the no noise case where we performed three repetitions. (b,c)Representativereconstructionsfor0.5%and4.0%noiseamplitudesrelativetoU . Predictionsremainstable 95 andphysicallyconsistentevenathighnoiselevels,confirmingthatthedifferentiablesolveractsasastrongphysicalregularizer. --- Page 17 --- 17 FIG.S6. Training convergence and velocity-profile recovery for noisy data. (a)Evolutionofthelossfunctionduring TBNN training for 4.0% noise amplitude relative to U shows a smaller decrease than the noise-free example, reflecting the 95 irreducible mismatch introduced by measurement noise. (b) Axial velocity profile at the constriction throat comparing the ground-truth field, noisy reference data, and TBNN predictions before and after training. The trained model matches the ground-truth profile with minimal residual error despite noise. Note that values within the solid obstacle (where the velocity should be zero) are excluded from training but shown here for visual continuity. --- Page 18 --- 18 SUPPLEMENTARY TABLES TABLE S1. Parameter ranges and distributions for the random generation of ground truth models. For each parameter, we list the range of values and the distribution from which it is sampled. Model Parameter Range Distribution Newtonian Viscosity (η) [0.1, 10.0] Log Zero-shear viscosity (η ) [1.0, 100.0] Log 0 Infinite-shear viscosity (η ) [0.01, 0.1] Log ∞ Carreau-Yasuda Consistency index (k) [0.1, 10.0] Uniform Power-law index (n) [0.2, 0.7] Uniform Transition parameter (a) [0.5, 3.0] Uniform Polymer viscosity (η ) [1.0, 10.0] Uniform p Oldroyd-B Relaxation time (λ) [1.0, 10.0] Uniform Solvent viscosity (η ) [0.1, 10.0] Uniform s Polymer viscosity (η ) [0.1, 10.0] Log p Relaxation time (λ) [1.0, 10.0] Log Giesekus Solvent viscosity (η ) [0.1, 10.0] Log s Mobility factor (α) [0.01, 0.5] Uniform Polymer viscosity (η ) [0.1, 10.0] Log p Relaxation time (λ) [1.0, 10.0] Log Linear PTT Solvent viscosity (η ) [0.1, 10.0] Log s Elongational parameter (ζ) [0.01, 0.2] Uniform Mobility parameter (ϵ) [0.01, 0.5] Uniform